<!doctype html>
<html>
	<head>
		<meta name='viewport' content='viewport-fit=cover, width=device-width, initial-scale=1.0, user-scalable=0'>
		<script src="https://telegram.org/js/telegram-web-app.js?57"></script>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=play_circle" />
	</head>
	<body>
		<div class="container" id="container">
			<div class="circle"></div>
			<div class="circle"></div>
			<div class="circle"></div>
			<div class="circle"></div>
			<div class="circle"></div>
			<div class="circle"></div>
		</div>
		<span class="material-symbols-rounded" id="icon">
			play_circle
		</span>
		<p id="caption"></p>
	</body>

	<style>
		.material-symbols-rounded {
			font-variation-settings:
			'FILL' 1,
			'wght' 400,
			'GRAD' 0,
			'opsz' 24
		}

		body {
			-webkit-tap-highlight-color: transparent;
			user-select: none !important;
			padding: 0;
			margin: 0;

			transition:         background-color 200ms ease;
			-webkit-transition: background-color 200ms ease;
		}

		div.container {
			display: grid;
			grid-auto-flow: column;
			gap: 0;
			height: 100vw;
			overflow-y: hidden;
			overscroll-behavior-x: contain;
			scroll-snap-type: x mandatory;
			scrollbar-width: none;
		}

		div.container::-webkit-scrollbar {
			display: none;
		}

		div.circle {
			width: 80vw;
			height: 80vw;
			margin: 10vw;
			background-color: #000;
			border-radius: 80vw;
			scroll-snap-align: center;
			overflow-y: hidden;
			display: table; 
		}

		p#caption {
			width: 100vw;
			text-align: center;
			font-size: 12pt;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
			font-weight: bold;
			color: #141414;
		}

		span {
			width: 20vw;
			height: 20vw;
			font-size: 20vw !important;
			position: absolute;
			top: 40vw;
			left: 40vw;
			color: #000;

			transition:         color 200ms ease;
			-webkit-transition: color 200ms ease;
			transition:         transform 100ms ease;
			-webkit-transition: transform 100ms ease;
		}
	</style>
	<script>
		var cont = document.getElementById('container');
		var timer = null;
		let modes = ['15 мин', '30 мин', '1 ч', '2 ч', '4 ч', '8 ч', '10 ч', '12 ч']
		let currentMode;
		let noises = [['brown noise', '#795548', '#BCAAA4'], ['deep brown noise', '#3E2723', '#A1887F'], ['pink noise', '#EC407A', '#F8BBD0'], ['red noise', '#F44336', '#FFCDD2'], ['deep red noise', '#B71C1C', '#EF9A9A'], ['violet noise', '#AB47BC', '#E1BEE7']]
		let currentNoise = 0;

		document.getElementById('caption').innerHTML = noises[currentNoise][0];
		document.getElementById('icon').style.color = noises[currentNoise][2];
		for (let i = 0; i < noises.length; i++) {
                cont.children[i].style.backgroundColor = noises[i][1];
            }

		cont.addEventListener('scroll', function () {
			if (timer !== null) {
				clearTimeout(timer);
			}
			timer = setTimeout(function() {
				if (cont.scrollLeft % window.innerWidth === 0) {
					if (cont.scrollLeft / window.innerWidth != currentNoise) {
						currentNoise = cont.scrollLeft / window.innerWidth;
						Telegram.WebApp.HapticFeedback.impactOccurred('soft');
						document.getElementById('caption').innerHTML = noises[currentNoise][0];
						Telegram.WebApp.MainButton.setParams({color: noises[currentNoise][1]});
						Telegram.WebApp.SecondaryButton.setParams({color: noises[currentNoise][2]});
						document.body.style.backgroundColor = noises[currentNoise][2];
						document.getElementById('icon').style.color = noises[currentNoise][2];
						Telegram.WebApp.setHeaderColor(noises[currentNoise][2]);
						Telegram.WebApp.setBackgroundColor(noises[currentNoise][2]);
						Telegram.WebApp.setBottomBarColor(noises[currentNoise][2]);
					}
				}
			}, 100);

			if (cont.scrollLeft % window.innerWidth != 0) {
				percent = (cont.scrollLeft % window.innerWidth) / (window.innerWidth / 100) / 100;
				small = 0.2 + 0.8 * (1 - percent);
				big = 0.2 + 0.8 * percent;
				current = Math.floor(cont.scrollLeft / window.innerWidth);
				cont.children[current].style.transform = 'scale(' + small + ')';
				if (current != noises.length-1) {
					cont.children[current+1].style.transform = 'scale(' + big + ')';
				}
			} else {
				cont.children[Math.floor(cont.scrollLeft / window.innerWidth)].style.transform = 'scale(1)';
			}
		});

		document.getElementById('icon').addEventListener('click', function () {
			document.getElementById('icon').style.transform = 'scale(0.8)';
			setTimeout(function () {
				document.getElementById('icon').style.transform = 'scale(1)';
			}, 100)
		});


		Telegram.WebApp.setBottomBarColor(noises[currentNoise][2]);
		
		Telegram.WebApp.MainButton.setParams({text: 'таймер сна', color: noises[currentNoise][1], text_color: '#ffffff', is_active: true});
		Telegram.WebApp.MainButton.show();

		Telegram.WebApp.SecondaryButton.setParams({text: 'осталось 1 ч', color: noises[currentNoise][2], text_color: '#141414', position: 'bottom', is_active: true});
		// Telegram.WebApp.SecondaryButton.show();

		Telegram.WebApp.MainButton.onClick( function () {
			Telegram.WebApp.HapticFeedback.impactOccurred('soft');
			if (currentMode == null | currentMode == modes.length-1) {
				currentMode = 0;
			} else {
				currentMode++;
			}
			Telegram.WebApp.MainButton.setText('таймер сна: ' + modes[currentMode]);
			Telegram.WebApp.SecondaryButton.show();
			Telegram.WebApp.SecondaryButton.setText('осталось ' + modes[currentMode]);
			// start timer
		});

		Telegram.WebApp.SecondaryButton.onClick( function () {
			Telegram.WebApp.HapticFeedback.impactOccurred('soft');
			currentMode = null;
			Telegram.WebApp.MainButton.setText('таймер сна');
			Telegram.WebApp.SecondaryButton.hide();
			// stop timer
		});
	</script>
</html>
